<!DOCTYPE html>
<html>
<!--
Welcome to the source code for howtogetfreehttps.com!

This is an open source website that is meant to be auditable. Please read
through the code here to see what's going on! All of the source code is on this
page, so you don't have to worry about any dependencies or other libraries.

Released under MIT License. Enjoy!
-->
<head>
    <title>Get HTTPS for free!</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <style>
        *{box-sizing:border-box;}
        div{margin:15px 0px;}
        .error{color:#ff1111;}
        .field{width:100%;max-width:600px;}
        li{margin-bottom:10px;}
        input[type="text"]{width:100%;}
        textarea{width:100%;height:120px;white-space:pre;}
        .help{float:right;font-size:12px;}
        .help-content{display:inline-block;width:100%;max-width:600px;margin:5px 0px 10px 0px;padding:10px;background-color:#eeeeee;}
        code{display:inline-block;margin:5px 0px;padding:5px;background-color:#ffffff;}
        pre{margin:5px 0px;padding:5px;overflow:auto;background-color:#ffffff;}
        .footer{font-size:12px;}
    </style>
    <script src="js/asn1js/int10.js"></script>
    <script src="js/asn1js/base64.js"></script>
    <script src="js/asn1js/hex.js"></script>
    <script src="js/asn1js/asn1.js"></script>
</head>
<body>

    <!--#############-->
    <!--##  Intro  ##-->
    <!--#############-->
    <h1>Get HTTPS for free!</h1>
    <h2 id="digest_error" class="error" style="display:none;">
        ERROR: Your browser is not compatible with this website (this website
        needs WebCryptoAPI's crypto.subtle.digest()). Please upgrade to a modern
        browser (Firefox, Chrome, Safari, IE 11+).
    </h2>
    <div>
        You can now get free https certificates from the non-profit certificate
        authority <a href="https://letsencrypt.org/">Let's Encrypt</a>!
        This is a website that will take you through the manual steps to get your free
        https certificate so you can make your own website use https! This website is
        <a href="https://github.com/diafygi/howtogetfreehttps">open source</a> and never
        asks for your private keys. <a href="renew.html">Click here</a> to renew certs.
        <a href="revoke.html">Click here</a> to revoke certs.
    </div>

    <div>
        <b>NOTE: This website is for people who know how to generate certificate signing
        requests (CSRs)!</b> If you're not familiar with how to do this, please use the
        official Let's Encrypt <a href="https://github.com/letsencrypt/letsencrypt">client</a>
        that can automatically issue and install https certificates for you. This
        website is designed for people who know what they are doing and just want to get
        their free https certificate.
    </div>

    <hr/>

    <!--####################-->
    <!--##  Account Info  ##-->
    <!--####################-->
    <h2>Step 1: Account Info</h2>
    <div>
        Let's Encrypt requires that you register a account email and public key before
        issuing a certificate. The email is so that they can account you if needed, and
        the public key is so you can securely sign your requests to issue/revoke/renew
        your certificates. <i>Keep your account private key secret! Anyone who has it
        can impersonate you when making requests to Let's Encrypt!</i>
    </div>

    <div class="field">
        <label for="email">Account Email:</label><br/>
        <input id="email" type="text" placeholder="(e.g. webmaster@yourdomain.com)"/>
    </div>

    <div class="field">
        <a id="howto_pubkey" class="help" href="#">(how do I generate this?)</a>
        <label for="pubkey">Account Public Key:</label><br/>
        <span id="howto_pubkey_content" class="help-content" style="display:none;">
            How to generate a new account keypair using openssl:<br/>
            <ol>
                <li>
                    Generate a account private key if you don't have one:<br/>
                    (KEEP ACCOUNT.KEY SECRET!)</br>
                    <code>openssl genrsa 4096 > account.key</code>
                </li>
                <li>
                    Print your public key:</br>
                    <code>openssl rsa -in account.key -pubout</code>
                </li>
                <li>
                    Copy and paste the public key in to the box below.</br>
                </li>
            </ol>
        </span>
        <textarea id="pubkey" placeholder="-----BEGIN PUBLIC KEY----- ..."></textarea>
    </div>

    <div class="field">
        <input id="validate_account" type="submit" value="Validate Account Info"/>
        <span id="validate_account_status" style="display:none;"></span>
    </div>

    <hr/>

    <!--###################################-->
    <!--##  Certificate Signing Request  ##-->
    <!--###################################-->
    <h2>Step 2: Certificate Signing Request</h2>
    <div>
        This is the certificate signing request (CSR) that you send to Let's Encrypt
        in order issue you a signed certificate. It contains the website domains you
        want to issue certs for and the public key of your TLS private key. <i>Keep your
        TLS private key secret! Anyone who has it can man-in-the-middle your websites!</i>
    </div>

    <div class="field">
        <a id="howto_csr" class="help" href="#">(how do I generate this?)</a>
        <label for="csr">Certificate Signing Request:</label><br/>
        <span id="howto_csr_content" class="help-content" style="display:none;">
            How to generate a new Certificate Signing Request (CSR):<br/>
            <ol>
                <li>
                    Generate a domain private key if you don't have one:<br/>
                    (KEEP DOMAIN.KEY SECRET!)</br>
                    <code>openssl genrsa 4096 > domain.key</code>
                </li>
                <li>
                    Generate a CSR for your the domains you want certs for:</br>
                    (replace "foo.com" with your domain)</br>
                    <code>openssl req -new -sha256 -key domain.key -subj "/" -reqexts SAN -config <(cat /etc/ssl/openssl.cnf <(printf "[SAN]\nsubjectAltName=DNS:foo.com,DNS:www.foo.com"))</code>
                </li>
                <li>
                    Copy and paste the CSR in to the box below.</br>
                </li>
            </ol>
        </span>
        <textarea id="csr" placeholder="-----BEGIN CERTIFICATE REQUEST----- ..."></textarea>
    </div>

    <div class="field">
        <input id="validate_csr" type="submit" value="Validate CSR"/>
        <span id="validate_csr_status" style="display:none;"></span>
    </div>

    <hr/>

    <!--#####################-->
    <!--##  Sign Requests  ##-->
    <!--#####################-->
    <h2>Step 3: Sign API Requests<span id="step3_pending"> (waiting...)</span></h2>
    <div id="step3" style="display:none;">
        <div>
            Let's Encrypt requires that you sign all of your requests to them with your
            account private key. Below are the requests that you will need to sign. The
            commands to do this are generated below so you can copy-and-paste them into your
            terminal. <i>Be sure to change the account private key location so it points to
            your real private key.</i>
        </div>

        <div class="field">
            <a id="howto_sign1" class="help" href="#">(how do I do this?)</a>
            <label>Run these signature commands in your terminal:</label><br/>
            <span id="howto_sign1_content" class="help-content" style="display:none;">
                How to generate the needed signatures:<br/>
                <ol>
                    <li>
                        Navigate in the terminal to the directory with account private
                        key ("account.key" or whatever you named it).
                    </li>
                    <li>
                        Copy and paste each command below into your terminal (if your
                        account private key isn't named "account.key", change "account.key"
                        in the command to whatever you named it).
                    </li>
                    <li>
                        Copy and paste the base64 encoded signature output from the command
                        into the text field below that command.
                    </li>
                </ol>
            </span>
            <div id="step3_commands">
            </div>
        </div>

        <div class="field">
            <input id="validate_initial_sigs" type="submit" value="Validate Signatures"/>
            <span id="validate_initial_sigs_status" style="display:none;"></span>
        </div>
    </div>

    <hr/>

    <!--##################-->
    <!--##  Challenges  ##-->
    <!--##################-->
    <h2>Step 4: Verify Ownership<span id="step4_pending"> (waiting...)</span></h2>
    <div id="step4" style="display:none;">
        <div>
            Let's Encrypt requires you prove you own the domains you have in your CSR. You
            can do this by serving a specific file at a specific url under your domains.
            Below are the files you need to serve along with some copy-and-paste commands
            you can run on your website to start serving the file. Once you are serving
            the file on your website, click "I'm now running this on...". After that, you
            need to tell Let's Encrypt to check the above files to verify ownership of your
            domains. This request needs to be signed with your account private key. Below
            are the verification requests that you will need to sign. The commands to do
            this are generated below so you can copy-and-paste them into your terminal.
            <i>Be sure to change the account private key location so it points to your real
            private key.</i>
        </div>

        <div id="challenge_domains">
        </div>

        <div id="challenge_template" style="display:none;">
            <h3>Domain: <span class="domain">foobar.com</span></h3>

            <div class="field">
                <a class="howto_sign help" href="#">(how do I do this?)</a>
                <label>Run this signature command in your terminal:</label><br/>
                <span class="howto_sign_content help-content" style="display:none;">
                    How to generate the needed signatures:<br/>
                    <ol>
                        <li>
                            Navigate in the terminal to the directory with account private
                            key ("account.key" or whatever you named it).
                        </li>
                        <li>
                            Copy and paste each command below into your terminal (if your
                            account private key isn't named "account.key", change "account.key"
                            in the command to whatever you named it).
                        </li>
                        <li>
                            Copy and paste the base64 encoded signature output from the command
                            into the text field below that command.
                        </li>
                    </ol>
                </span>
                <div class="step4_commands">
                </div>
            </div>

            <div class="field">
                <a class="howto_serve help" href="#">(how do I do this?)</a>
                <label>Run this command on <span class="domain">foobar.com</span>'s server:</label><br/>
                <span class="howto_serve_content help-content" style="display:none;">
                    How to serve the challenge response on your domain:<br/>
                    <ol>
                        <li>
                            SSH into your domain as someone with sudo permissions:<br/>
                            <code>ssh ubuntu@foo.com</code>
                        </li>
                        <li>
                            Stop any webserver running on port 80, if any. If you had previously
                            been running another python command, you can kill it with Ctrl+C):<br/>
                            <code>sudo service nginx stop</code> &lt;-- example for nginx<br/>
                            <code>sudo apachectl -k graceful-stop</code> &lt;-- example for apache
                        </li>
                        <li>
                            Copy and paste the python command below into your terminal. This
                            command starts a temporary webserver that serves nothing but the
                            challenge response. You only need to keep this running briefly.
                        </li>
                        <li>
                            Click "I'm now running this command..." when the file is being
                            served on your domain.
                        </li>
                    </ol>
                </span>
                <textarea readonly>sudo python ...</textarea>
            </div>

            <div class="field">
                <input type="submit" value="I'm now running this command on foobar.com"/>
            </div>
        </div>
    </div>

    <hr/>

    <!--#########################-->
    <!--##  Issue Certificate  ##-->
    <!--#########################-->
    <h2>Step 5: Install Certificate<span id="step5_pending"> (waiting...)</span></h2>
    <div id="step5" style="display:none;">
        <div>
            Congratulations! Let's Encrypt has issued you a certificate for your domains!
            Below is the signed certificate you can use on your website to
        </div>

        <div class="field">
            <a id="howto_install" class="help" href="#">(how do I install this?)</a>
            <label for="csr">Signed Certificate:</label><br/>
            <span id="howto_install_content" class="help-content" style="display:none;">
                How to install https on nginx:<br/>
                <ol>
                    <li>
                        Copy and paste both the below domain certificate and the below
                        intermediate certificate into the same text file called "chained.pem".
                    </li>
                    <li>
                        If not done already, generate non-default dhparams.<br/>
                        <code>openssl dhparam -out dhparam.pem 4096</code>
                    </li>
                    <li>
                        Copy "chained.pem" and "dhparam.pem" to /etc/ssl/certs/.<br/>
                        <pre>
scp chained.pem root@foo.com:/etc/ssl/certs/chained.pem
scp dhparam.pem root@foo.com:/etc/ssl/certs/dhparam.pem
</pre>
                    </li>
                    <li>
                        Copy "domain.key" /etc/ssl/private/.<br/>
                        <code>scp chained.pem root@foo.com:/etc/ssl/private/domain.key</code><br/>
                    </li>
                    <li>
                        Update your nginx config to use https (below is an example).
                        <pre>
server {
    listen 443;
    server_name foo.com;
    ssl on;
    ssl_certificate /etc/ssl/certs/chained.pem;
    ssl_certificate_key /etc/ssl/private/domain.key;
    ssl_session_timeout 5m;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA;
    ssl_session_cache shared:SSL:50m;
    ssl_dhparam /etc/ssl/certs/dhparam.pem;
    ssl_prefer_server_ciphers on;

    location / {
        return 200 'Hello world!';
        add_header Content-Type text/plain;
    }
}
</pre>
                    </li>
                </ol>
            </span>
            <textarea readonly>
            -----BEGIN CERTIFICATE-----
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            -----END CERTIFICATE-----
            </textarea>
        </div>

        <div class="field">
            <label for="csr">Intermediate Certificate:</label><br/>
            <textarea readonly>
            -----BEGIN CERTIFICATE-----
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            -----END CERTIFICATE-----
            </textarea>
        </div>

        <div class="field">
            <form action="https://www.ssllabs.com/ssltest/analyze.html" target="_blank">
                <input type="hidden" name="d" value="foobar.com">
                <input type="submit" value="Test my install"/>
            </form>
        </div>
    </div>

    <hr/>

    <div class="footer">
        This website is released under the MIT license and the source code is available
        here: <a href="https://github.com/diafygi/howtogetfreehttps" target="_blank">https://github.com/diafygi/howtogetfreehttps</a>
    </div>
    <script src="js/index.js"></script>
</body>
</html>
